
# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
parameters:
  eventsourcerer.application_name: 'EventSourcerer'
  eventsourcerer.application_id: '%env(EVENTSOURCERER_APPLICATION_ID)%'
  eventsourcerer.host: '%env(EVENTSOURCERER_HOST)%'
  eventsourcerer.port: '%env(int:EVENTSOURCERER_PORT)%'
  eventsourcerer.url: '%env(EVENTSOURCERER_URL)%'

services:
  # default configuration for services in *this* file
  _defaults:
    autowire: true      # Automatically injects dependencies in your services.
    autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.
    bind:

  PearTreeWeb\EventSourcerer\Client\Infrastructure\Config:
    factory: ['EventSourcerer\ClientBundle\Infrastructure\ConfigFactory', 'create']
    arguments:
      $host: '%eventsourcerer.host%'
      $url: '%eventsourcerer.url%'
      $port: '%eventsourcerer.port%'
      $applicationId: '%eventsourcerer.application_id%'

  PearTreeWeb\EventSourcerer\Client\Infrastructure\Client:
    factory: ['EventSourcerer\ClientBundle\Infrastructure\ClientFactory', 'create']
    arguments:
      $config: '@PearTreeWeb\EventSourcerer\Client\Infrastructure\Config'
      $dbalConnection: '@doctrine.dbal.default_connection'

  EventSourcerer\ClientBundle\Transport\EventSourcererTransportFactory:
    tags: [ messenger.transport_factory ]

  EventSourcerer\ClientBundle\Command\ListenForEvents:
    tags:
      - { name: console.command }

  EventSourcerer\ClientBundle\Command\CreateExternalSocketConnection:
    tags:
      - { name: console.command }

  EventSourcerer\ClientBundle\Command\GetSummary:
    tags:
      - { name: console.command }

  EventSourcerer\ClientBundle\Command\ListAllEvents:
    tags:
      - { name: console.command }
